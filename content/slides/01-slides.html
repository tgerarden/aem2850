<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Welcome to AEM 2850 / 5850!</title>
    <meta charset="utf-8" />
    <meta name="author" content="Todd Gerarden" />
    <script src="libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/tdg-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">










class: center middle main-title section-title-4

# Welcome to AEM 2850 / 5850!

.class-info[

**Week 1**

AEM 2850 / 5850 : R for Business Analytics&lt;br&gt;
Cornell Dyson&lt;br&gt;
Fall 2025

Acknowledgements:
[Andrew Heiss](https://datavizm20.classes.andrewheiss.com), 
[Claus Wilke](https://wilkelab.org/SDS375/), 
[Grant McDermott](https://github.com/uo-ec607/lectures)

]

---

name: outline

# Plan for today

[Why take R for Business Analytics?](#r-business-analytics)

[Summary of key class details](#class-details)

[Teaser programming example](#teaser)

[What makes a great data visualization?](#beautiful-visualizations)

[Basic base R (for reference)](#outline-base-r)


---

layout: false
name: r-business-analytics
class: inverse, center, middle

# Why take R for Business Analytics?

---

# Why take R for Business Analytics?

&lt;br&gt;

.center[
&lt;img src = "img/01/Data_visualization_venn.svg", width = 60%&gt;&lt;/img&gt;
]


---

# Why R for Business Analytics?

&lt;img src = "img/01/Rlogo.svg", width = 25%, style = "position:absolute; top: 25%; left: 15%;"&gt;&lt;/img&gt;

--

&lt;img src = "img/01/rstudio-logo.png", width = 35%, style = "position:absolute; top: 65%; left: 8%;"&gt;&lt;/img&gt;


???

The R logo [is distributed](https://www.r-project.org/logo/) under the terms of the Creative Commons Attribution-ShareAlike 4.0 International license ([CC-BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/)).

RStudio tidyverse hex stickers [are distributed](https://github.com/rstudio/hex-stickers) under [CC0.](https://github.com/rstudio/hex-stickers/blob/master/LICENSE.md)

Tidyverse image came from RStudio education blog post [here](https://education.rstudio.com/blog/2020/07/teaching-the-tidyverse-in-2020-part-1-getting-started/)

--

&lt;img src = "img/01/tidyverse-packages.png", width = 50%, style = "position:absolute; top: 25%; left: 45%;"&gt;&lt;/img&gt;

---

# Why R for Data Visualization?

.pull-left[

&lt;figure&gt;
  &lt;img src="img/01/ggplot2.svg" alt="ggplot logo" title="ggplot logo" width="85%"&gt;
&lt;/figure&gt;

]

--

.pull-right[

&amp;nbsp;

&lt;figure&gt;
  &lt;img src="img/01/ggplot-layers@4x.png" alt="ggplot logo" title="ggplot logo" width="100%"&gt;
&lt;/figure&gt;

]

---



# Why R for Data Visualization?

.center[
&lt;figure&gt;
  &lt;img src="img/01/complexity-chart@4x.png" alt="Complexity chart" title="Complexity chart" width="65%"&gt;
&lt;/figure&gt;
]



---

# Why R for Life?

Practical tool that could help you get a job and then do said job

--

.pull-left.center[

&lt;figure&gt;
  &lt;img src="img/01/airbnb.png" alt="Airbnb's data science tools" title="Airbnb's data science tools" width="100%"&gt;
&lt;/figure&gt;

.small[[Airbnb, ggplot, and rmarkdown](https://peerj.com/preprints/3182/)]

]

.pull-right.center[

&amp;nbsp;

&lt;figure&gt;
  &lt;img src="img/01/uk-long.png" alt="UK Statistics pipeline" title="UK Statistics pipeline" width="100%"&gt;
&lt;/figure&gt;

&lt;figure&gt;
  &lt;img src="img/01/uk-short.png" alt="UK Statistics pipeline, short" title="UK Statistics pipeline, short" width="55%"&gt;
&lt;/figure&gt;

.small[[The UK's reproducible analysis pipeline](https://dataingovernment.blog.gov.uk/2017/03/27/reproducible-analytical-pipeline/)]

]

???

https://peerj.com/preprints/3182.pdf + https://gdsdata.blog.gov.uk/2017/03/27/reproducible-analytical-pipeline/ 





---

# Why R for Life?

Practical tool that could help you get a job and then do said job

.center[

&lt;figure&gt;
  &lt;img src="img/01/hilton-hackathon.jpg" alt="Hilton Hospitality Hackathon at Cornell" title="Hilton Hospitality Hackathon at Cornell" width="75%"&gt;
&lt;/figure&gt;

**Or start making money now!**

]

---

# Why R for Life?

Practical tool that could help you get a job and then do said job

Open source

--

Huge community of users and package developers

--

Here are a few examples of other things you can do using R:
- Make slides like the ones you're looking at right now
- Build websites like [our course site](https://aem2850.toddgerarden.com)
- Write books like [R for Data Science](https://r4ds.hadley.nz)
- Make interactive web apps

--

Skills from this course can also be used for other programming languages


---

layout: false
name: class-details
class: inverse, center, middle

# Class details

---

# Preface

1. Your success in this class is important to me

2. Get the semester off to a good start: **[read the syllabus](https://www.cameo.com/v/5f2b392a0299b100202e624a?utm_campaign=video_share_to_copy)**!


---

# A bit about me

.pull-left[.center[
&lt;figure&gt;
  &lt;img src="img/01/me.jpg" alt="me" title="me" width="100%"&gt;
&lt;/figure&gt;
]]

.pull-right[
- Prof. Todd Gerarden

- Economist

- Came to Cornell in 2018

- Interested in:
  - Energy markets
  - Climate tech
  - Innovation
  - Working with data
]

---

# A bit about our TAs

### Graduate TAs

Victor Simoes Dornelas

Xiaorui Wang

**We will post office hours and contact info on the course site and canvas**


---

# A bit about you

Do you have any programming experience? (None is required or even expected!)

--

What programming language(s) have you used before?
- R
- Python
- SQL
- VBA
- MATLAB
- Stata
- Other

--

First course assignment will be to fill out a survey to tell us more about you

---

# Course objectives

1. Develop basic proficiency in `R` programming
2. Understand data structures and manipulation
3. Describe effective techniques for data visualization and communication
4. Construct effective data visualizations
5. Utilize course concepts and tools for business applications


---

# Plan for the semester

.pull-left[
#### Programming Foundations

`R`, `RStudio`, `Quarto`, the `tidyverse`
]

.pull-right[
&lt;figure&gt;
  &lt;img src="img/01/data-science-wrangle.png" alt="data-science-wrangle" title="data-science" width="75%"&gt;
&lt;/figure&gt;
]

--

.pull-left[
#### Data Visualization Foundations

the grammar of graphics, `ggplot2`
]

.pull-right[
&lt;figure&gt;
  &lt;img src="img/01/data-science-explore.png" alt="data-science-explore" title="data-science" width="75%"&gt;
&lt;/figure&gt;
]

--

.pull-left[
#### Special Topics

functions, scraping, spatial data, etc.
]

.pull-right[
&lt;figure&gt;
  &lt;img src="img/01/data-science-communicate.png" alt="data-science-communicate" title="data-science" width="75%"&gt;
&lt;/figure&gt;
]


---

# Plan for each week

We will follow the same general process each week:

- Do readings listed on the course site before Tuesday ([example: Week 1](https://aem2850.toddgerarden.com/content/01-content/))

- **Tuesday:** come to class, where we will discuss material for that week's topic

- **Thursday:** come to class, where we will work through hands-on examples

- We will often blend together new material and hands-on examples both days

- Work on the homework, attend office hours as needed

- **Monday (following):** submit homework on canvas by 11:59pm

---

# Assignments

.more-left[
- **Homeworks** are weekly assignments to practice programming

- **Prelims** are intended to assess programming and data visualization proficiency

- The **group project** is intended to synthesize and reinforce skills in real-world applications

- **Class participation** is the best way to learn the material; attendance and completion of in-class examples is required
]




.less.right[

|Assignment          | Percent|
|:-------------------|-------:|
|Homeworks           |     35%|
|Prelim 1            |     20%|
|Prelim 2            |     20%|
|Group project       |     20%|
|Class participation |      5%|
|Total               |    100%|
]


---

# Contacting us

### Office hours:

- Teaching Assistants:
  - Mondays 2:00pm - 6:00pm in Warren 370
  - Fridays 1:00pm - 2:00pm, location TBD
- Prof. Gerarden:
  - Tuesdays 11:30am - 12:30pm in Warren 464
  - Other times by appointment: [aem2850.youcanbook.me](https://aem2850.youcanbook.me)

You can also reach us by email. The best approach is to email both me and our grad TAs at the same time. You can do that with one click [here](mailto:gerarden@cornell.edu,vs424@cornell.edu,xw427@cornell.edu). **Please** read the syllabus for tips on how to make the most of email.


---

# Course websites

### Site for accessing course materials: (↓)
[aem2850.toddgerarden.com](https://aem2850.toddgerarden.com)

### Site for submitting work: (↑)
[https://canvas.cornell.edu/courses/76511](https://canvas.cornell.edu/courses/76511)
- viewing announcements
- viewing grades
- you can also view and navigate the course site through canvas

---

# Sucking

.small[
&gt; "The bad news is whenever you’re learning a new tool, for a long time you’re going to suck. It's going to be very frustrating.
&gt; 
&gt; But, the good news is that that is typical, it’s something that happens to everyone, and it’s only temporary...
&gt; 
&lt;!-- &gt; Unfortunately, there is no way to go from knowing nothing about a subject to knowing something about a subject and being an expert in it without going through a period of great frustration and much suckiness. --&gt;
&lt;!-- &gt;  --&gt;
&lt;!-- &gt; But remember, when you're getting frustrated, that's a good thing, that's temporary, keep pushing through, and in time [it] will become second nature." --&gt;
&gt; Remember, when you're getting frustrated, that's a good thing, that's temporary, keep pushing through, and in time [it] will become second nature."
]

.small[Hadley Wickham, author of `ggplot2`, *R for Data Science*, and much more]

--

#### I *know* you can succeed in this class. Don't hesitate to get help from me, TAs, office hours, and your peers.

???

[Source for quote](https://twitter.com/Akbaritabar/status/1022057084802748416)

---

layout: false
class: inverse, center, middle

# Questions about the class?

---

layout: false
name: teaser
class: inverse, center, middle

# Teaser programming example

---

# How does 2025 compare to 2024 so far?

Let's make a plot that compares returns of the S&amp;P 500 this year versus last year

You can download the raw data on the S&amp;P 500 price index [here](https://aem2850.toddgerarden.com/slides/data/01-slides/SP500.csv)

.pull-left[
How would you use these data to compare *returns* in 2025 vs 2024?
]

.pull-right[
&lt;figure&gt;
  &lt;img src="img/01/sp500-prices.png" alt="S&amp;P 500 price data" title="S&amp;P 500 price data" width="95%"&gt;
&lt;/figure&gt;
]

???

Source: https://fred.stlouisfed.org/series/SP500

---

# How does 2025 compare to 2024 so far?

One way to do this in R. First, we'll need to import and prep the data:


``` r
# load the tidyverse package
library(tidyverse)

# import the data
prices &lt;- read_csv("data/01-slides/SP500.csv")

# compute returns each year
returns &lt;- prices |&gt; 
  mutate(
    year = year(observation_date),
    md   = format(observation_date, "%m-%d")
  ) |&gt; 
  filter(!is.na(SP500)) |&gt; 
  group_by(year) |&gt; 
  arrange(observation_date, .by_group = TRUE) |&gt; 
  mutate(annual_return = (SP500 / first(SP500) - 1) * 100)
```




---

# How does 2025 compare to 2024 so far?

.pull-left[

``` r
# plot data
returns |&gt; 
  ggplot(aes(
    x = date, 
    y = annual_return
  )) + 
  geom_line() + 
  scale_x_date(date_labels = "%b") +
  theme_bw()
```

What's wrong with this plot?
]

.pull-right[
  ![](01-slides_files/figure-html/sp500-plot1-1.png)
]

---

# How does 2025 compare to 2024 so far?

.pull-left[

``` r
# plot data
returns |&gt; 
  ggplot(aes(
    x = date, 
    y = annual_return, 
*   color = as_factor(year)
  )) +
  geom_line() + 
  scale_x_date(date_labels = "%b") +
  theme_bw() +
* theme(legend.position = "bottom")
```

What's wrong with this plot?
]

.pull-right[
  ![](01-slides_files/figure-html/sp500-plot2-1.png)
]

---

# How does 2025 compare to 2024 so far?

.pull-left[

``` r
# plot data
returns |&gt; 
  ggplot(aes(
    x = date, 
    y = annual_return, 
    color = as_factor(year)
  )) + 
  geom_line() + 
  scale_x_date(date_labels = "%b") +
  theme_bw() +
  theme(legend.position = "bottom") +
* labs(
*   x = "Month of year",
*   y = "Annual return (%)",
*   color = NULL,
*   title = "S&amp;P 500 returns over the years"
* )
```
]

.pull-right[
  ![](01-slides_files/figure-html/sp500-plot3-1.png)
]

---

# How does 2025 compare to 2024 so far?

This approach has two advantages over manually creating figures using software such as excel or sheets:
1. we have a script to **reproduce** our work / share our methods with others
2. we can **generalize** and **scale** this much more easily than manual approaches

---

# How does 2025 compare to 2024 so far?

For example we can easily **generalize** this approach to other outcomes:

.pull-left[

``` r
# plot data
returns |&gt; 
  ggplot(aes(
    x = date, 
*   y = SP500,
    color = as_factor(year)
  )) + 
  geom_line() + 
  scale_x_date(date_labels = "%b") +
  theme_bw() +
  theme(legend.position = "bottom") +
  labs(
    x = "Month of year",
*   y = "S&amp;P price index",
    color = NULL,
*   title = "S&amp;P 500 prices over the years"
  )
```
]

.pull-right[
  ![](01-slides_files/figure-html/sp500-plot4-1.png)
]

???

Note: NOAA publishes data with a slight lag


---

# How does 2025 compare to 2024 so far?

For example we can easily **scale** this approach to more years:

.pull-left[

``` r
*all_returns |&gt;
  ggplot(aes(
    x = date, 
    y = annual_return,
    color = as_factor(year)
  )) + 
  geom_line() + 
  scale_x_date(date_labels = "%b") +
  theme_bw() +
  theme(legend.position = "bottom") +
  labs(
    x = "Month of year",
    y = "Annual return (%)",
    color = NULL,
    title = "S&amp;P 500 returns over the years"
  )
```
]

.pull-right[
  ![](01-slides_files/figure-html/sp500-plot5-1.png)
]


---

layout: false
name: beautiful-visualizations
class: inverse, center, middle

# What makes a great data visualization?

---

# What makes a great data visualization?

.box-inv-6["Graphical excellence is the **well-designed presentation of interesting data**—a matter of substance, of statistics, and of design … [It] consists of complex ideas communicated with clarity, precision, and efficiency. … [It] is that which **gives to the viewer the greatest number of ideas in the shortest time with the least ink in the smallest space** … [It] is nearly always multivariate … And graphical excellence requires **telling the truth about the data**."]

.box-6.tiny[Edward Tufte, *The Visual Display of Quantitative Information*, p. 51]

---

# What makes a great data visualization?

.center[

.box-inv-6.medium[Good aesthetics]

.box-inv-6.medium[No substantive issues]

.box-inv-6.medium[No perceptual issues]

.box-inv-6.medium[Honesty + good judgment]

.box-6.tiny[Kieran Healy, *Data Visualization: A Practical Introduction*]

]

---

# Does anyone know what this is from?

.center[
&lt;figure&gt;
  &lt;img src="img/01/gpt-5-deception-chart.png.webp" alt="GPT-5 release chart from OpenAI" title="GPT-5 release chart from OpenAI" width="88%"&gt;
&lt;/figure&gt;
]

???

Source: https://www.pcgamer.com/software/ai/openais-performance-charts-in-the-gpt-5-launch-video-are-such-a-mess-you-have-to-think-gpt-5-itself-probably-made-them-and-the-companys-attempted-fixes-raise-even-more-questions/

---

# What's wrong?

.more-left[
&lt;figure&gt;
  &lt;img src="img/01/gpt-5-academic-chart.png" alt="GPT-5 release chart from OpenAI" title="GPT-5 release chart from OpenAI" width="85%"&gt;
&lt;/figure&gt;
]

.less-right[
Good aesthetics?

No substantive issues?

No perceptual issues?

Honesty + good judgment?
]

???

Source: https://www.reddit.com/r/dataisugly/comments/1mk5wdb/this_chart_from_openais_official_gpt5_release/

---

# What's wrong?

.more-left[
&lt;figure&gt;
  &lt;img src="img/01/pie-genus.png" alt="Distribution of genus" title="Distribution of genus" width="100%"&gt;
&lt;/figure&gt;
]

.less-right[
Good aesthetics?

No substantive issues?

No perceptual issues?

Honesty + good judgment?
]

---

# What's wrong?

.pull-left[
&lt;figure&gt;
  &lt;img src="img/01/changing-face-of-america.png" alt="Changing face of America" title="Changing face of America" width="100%"&gt;
&lt;/figure&gt;
]

.pull-right[
Good aesthetics?

No substantive issues?

No perceptual issues?

Honesty + good judgment?
]

---

# What's wrong?

.pull-left[
&lt;figure&gt;
  &lt;img src="img/01/how-stuff-works-recidivism.png" alt="Recidivism pie chart" title="Recidivism pie chart" width="100%"&gt;
&lt;/figure&gt;
]

.pull-right[
Good aesthetics?

No substantive issues?

No perceptual issues?

Honesty + good judgment?
]

---

# What's wrong?

.pull-left[
&lt;figure&gt;
  &lt;img src="img/01/bbc-gp-pie.png" alt="BCC GP pie chart" title="BCC GP pie chart" width="100%"&gt;
&lt;/figure&gt;
]

.pull-right[
Good aesthetics?

No substantive issues?

No perceptual issues?

Honesty + good judgment?

]

???

Source: https://statmodeling.stat.columbia.edu/2023/12/30/how-not-to-be-fooled-by-viral-charts/

---

# What's right?

.pull-left[
&lt;figure&gt;
  &lt;img src="img/01/nba-jordans-favorite-shot.png" alt="Jordan's favorite shot" title="Jordan's favorite shot" width="100%"&gt;
&lt;/figure&gt;
]

???

- Aesthetic issues
- Substantive issues
- Perceptual issues
- Honesty + judgment issues

--

.pull-right[
Simple and effective!

Illustrates the power of a **good question** and **good data**

Source: [Andrew Gelman](https://statmodeling.stat.columbia.edu/2024/06/23/some-fun-basketball-graphs/)
]

???

[Andrew Gelman on some fun basketball graphs](https://statmodeling.stat.columbia.edu/2024/06/23/some-fun-basketball-graphs/)

---

# What's right?

.more-left[
&lt;figure&gt;
  &lt;img src="img/01/nba-the-game-has-changed.png" alt="The game has changed (NBA shots heat map)" title="The game has changed chart" width="100%"&gt;
&lt;/figure&gt;
]

???

- Aesthetic issues
- Substantive issues
- Perceptual issues
- Honesty + judgment issues

--

.less-right[
Clear title and labeling

Juxtaposition

Color scheme could be improved

Source: [Andrew Gelman](https://statmodeling.stat.columbia.edu/2024/06/23/some-fun-basketball-graphs/)
]

???

[Andrew Gelman on some fun basketball graphs](https://statmodeling.stat.columbia.edu/2024/06/23/some-fun-basketball-graphs/)

---

# Plan for the rest of this week

### Office hours:

- Tuesdays 11:30am - 12:30pm: Prof. Gerarden in Warren 464
- Other times by appointment: Prof. Gerarden, at [aem2850.youcanbook.me](https://aem2850.youcanbook.me)

### Thursday:

- Intro to `R`, `RStudio`, and `R Markdown` / `Quarto`
- You will need your computer for coding exercises most days, every Thursday
- See canvas announcement for instructions to get set up on [posit.cloud](http://posit.cloud/)


---

name: outline-base-r

# Plan for the rest of today

Time permitting, let's introduce ourselves to **base** R

[Introduction to base R](#intro)

[Object-oriented programming in R](#oop)

["Everything is an object"](#eobject)

**Reference material** (cut for time):
  - ["Everything has a name"](#ename) (reserved words and namespace conflicts)
  - [Indexing](#indexing)
  - [Cleaning up](#cleaning)


---
class: inverse, center, middle
name: intro

# Introduction to base R

(just for reference, since we will cover most of this in example-01)

---

# Basic arithmetic

R is a powerful calculator and recognizes all of the standard arithmetic operators:


``` r
1+2 # add / subtract
```

```
## [1] 3
```

``` r
5/2 # divide
```

```
## [1] 2.5
```

``` r
2+4*1^3 # standard order of precedence (`*` before `+`, etc.)
```

```
## [1] 6
```

---

# Logic

R also comes equipped with a full set of logical operators and Booleans


``` r
1 &gt; 2
```

```
## [1] FALSE
```

``` r
(1 &gt; 2) &amp; (1 &gt; 0.5) # "&amp;" is the "and" operator
```

```
## [1] FALSE
```

``` r
(1 &gt; 2) | (1 &gt; 0.5) # "|" is the "or" operator
```

```
## [1] TRUE
```

---

# Logic

We can negate expressions with: `!`

This is helpful for filtering data


``` r
is.na(1:10)
```

```
##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
```

``` r
!is.na(1:10)
```

```
##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
```

`NA` means **not available** (i.e., missing)

---

# Logic

For value matching we can use: `%in%`

To see whether an object is contained in a list of items, use `%in%`:

``` r
1:10
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10
```

``` r
4 %in% 1:10
```

```
## [1] TRUE
```

``` r
4 %in% 5:10
```

```
## [1] FALSE
```

---

# Logic

To evaluate whether two expressions are equal, we need to use **two** equal signs


``` r
1 = 1 # this doesn't work
```

```
## Error in 1 = 1: invalid (do_set) left-hand side to assignment
```

``` r
1 == 1 # this does
```

```
## [1] TRUE
```

``` r
1 != 2 # note the single equal sign when combined with a negation
```

```
## [1] TRUE
```

---

# Logic

**Evaluation caveat:** What will happen if we evaluate `0.1 + 0.2 == 0.3`?

--


``` r
0.1 + 0.2 == 0.3
```

```
## [1] FALSE
```
&lt;!-- Uh-oh! What went wrong here? --&gt;

--

**Problem:** Computers represent numbers as binary (i.e., base 2) floating-points
- Fast and memory efficient, but can lead to unexpected behavior
- Similar to how decimals can't capture some fractions (e.g., `\(\frac{1}{3} = 0.3333...\)`)

--

**Solution:** Use `all.equal()` for evaluating floats (i.e., fractions)


``` r
all.equal(0.1 + 0.2, 0.3)
```

```
## [1] TRUE
```

???
More details [here](https://floating-point-gui.de/basic/)

---

# Assignment

In R, we can use either `&lt;-` or `=` to handle assignment

--

### Assignment with `&lt;-`

`&lt;-` is normally read aloud as "gets". You can think of it as a (left-facing) arrow saying *assign in this direction*.


``` r
a &lt;- 10 + 5
a
```

```
## [1] 15
```

---

# Assignment with `=`

You can also use `=` for assignment.


``` r
b = 10 + 10
b
```

```
## [1] 20
```

--

### Which assignment operator should you use?

Many R users prefer `&lt;-`, inserted using the keyboard shortcut Alt/Option + -

&lt;!-- , since `=` also has specific role for evaluation *within* functions --&gt;

It doesn't really matter for our purposes, other languages use `=`

**Bottom line:** Use whichever you prefer, just be consistent

---

# Help

For more information on a (named) function or object in R, consult the "help" documentation using `?`

For example:

```R
?plot 
```

---

# Vignettes

For some packages, `vignette()` will provide a detailed intro


``` r
vignette("dplyr")
```

Vignettes are a great way to learn how and when to use a package

---

# Comments


Comments in R code are demarcated by `#`

Use comments to document your logic in `.R` scripts and within `.Rmd` code chunks


``` r
# THIS IS A CODE SECTION ----
# this is a comment
winter &lt;- "ski season" # iykyk
```

--

Comments should be concise (unlike above)

--

Using at least four trailing dashes (`----`) creates a code section, which simplifies navigation and code folding
&lt;!-- - Also works with trailing equals (`====`) or pound signs (`====`) --&gt;

--

**Keyboard shortcut:** use `Ctrl/Cmd+Shift+c` in RStudio to (un)comment whole sections of highlighted code


---
class: inverse, center, middle
name: oop

# Object-oriented programming in R



---

# Object-oriented programming

In R:

&gt; **"Everything is an object and everything has a name."**


---
class: inverse, center, middle
name: eobject

# "Everything is an object"


---

# What are objects? 

There are many different *types* (or *classes*) of objects

Here are some objects that we'll be working with regularly:
- vectors
- matrices
- data frames
- lists
- functions


---

# Data frames

The most important object we will be working with is the **data frame**

You can think of it basically as an excel spreadsheet or google sheet


``` r
# create a small data frame called "d"
d &lt;- data.frame(x = 1:2, y = 3:4)
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

--

This is essentially just a table with columns named `x` and `y`

--

Each row is an observation telling us the values of `x` and `y`

---

# Aside: built-in data frames

Base R and packages have built-in data frames with special names you can call on

For example, `cars`:

.pull-left[

``` r
head(cars)
```

```
##   speed dist
## 1     4    2
## 2     4   10
## 3     7    4
## 4     7   22
## 5     8   16
## 6     9   10
```
]

.pull-right[

``` r
plot(cars)
```

&lt;img src="01-slides_files/figure-html/plot-cars-1.png" width="360" style="display: block; margin: auto;" /&gt;
]



---

# Back to objects

Each object class has its own set of rules for determining valid operations


``` r
d &lt;- data.frame(x = 1:2, y = 3:4) # create a small data frame called "d"
d*10
```

```
##    x  y
## 1 10 30
## 2 20 40
```

--

At the same time, you can (usually) convert an object from one type to another


``` r
mat &lt;- as.matrix(d) # convert it to (i.e., create) a matrix call "mat"
mat
```

```
##      x y
## [1,] 1 3
## [2,] 2 4
```

---

# Working with multiple objects

In R we can have multiple data frames in memory at once

Even though we just made `mat`, `d` still exists:


``` r
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

---

# Ways to learn about objects

Printing an object directly in the console is often handy

--

`View()` is very helpful, and has the same effect as clicking on the object in your RStudio *Environment* pane

--

Use the `str` command to learn about an object's **str**ucture


``` r
# d &lt;- data.frame(x = 1:2, y = 3:4) # create a small data frame called "d"
str(d) # evaluate its structure
```

```
## 'data.frame':	2 obs. of  2 variables:
##  $ x: int  1 2
##  $ y: int  3 4
```

--

You can also use `class` to get an object's class without all the other details


---
name: global_env

# Global environment

Let's go back to the simple data frame that we created a few slides earlier.

``` r
d
```

```
##   x y
## 1 1 3
## 2 2 4
```

--

Now, let's try to do a logical comparison of these "x" and "y" variables:


``` r
x &lt; y
```

```
## Error: object 'x' not found
```

--

Uh-oh. What went wrong here?

---

# Global environment

The error message provides the answer to our question:

```
*## Error in eval(predvars, data, env): object 'x' not found
```

--

R looked in our *Global Environment* and couldn't find `x`

&lt;img src="img/02/environment.png" width="70%" style="display: block; margin: auto;" /&gt;

--

We have to tell R that `x` and `y` belong to the object `d`

We will come back to this


---
class: inverse, center, middle

# Reference material

(We don't have time for the rest of this today)

---
class: inverse, center, middle
name: ename

# "Everything has a name"



---

# Reserved words

R has a bunch of key/reserved words that serve specific functions
- You can't (re)assign these, even if you wanted to

See [here](http://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html) for a full list, including (but not limited to):

```R
if 
else 
while # looping
function 
for # looping
TRUE 
FALSE 
NULL # null/undefined
Inf #infinity
NaN # not a number
NA # not available / missing
```

---

# Semi-reserved words

There are other words that are sort of reserved, in that they have a particular meaning
- These are named functions or constants (e.g., `pi`) that you can re-assign if you really want to... but that already come with important meanings from base R

The most important example is `c()`, which binds and concatenates objects together


``` r
my_vector &lt;- c(1, 2, 5)
my_vector
```

```
## [1] 1 2 5
```

---

# Semi-reserved words (cont.)

What do you think will happen if you type the following?


``` r
c &lt;- 4
c(1, 2 ,5)
```

--


```
## [1] 1 2 5
```

--

In this case, R is "smart" enough to distinguish between the variable `c` and the built-in function `c()`

---

# Semi-reserved words (cont.)

But R won't always distinguish between conflicting definitions! For example:

``` r
pi
```

```
## [1] 3.141593
```

``` r
pi &lt;- 2
pi
```

```
## [1] 2
```
--

**Bottom line:** Don't use (semi-)reserved words!

---

# Namespace conflicts

Try loading the `dplyr` package in RStudio

``` r
library(dplyr)
```

What warning gets reported?

    The following objects are masked from ‘package:stats’:

        filter, lag

    The following objects are masked from ‘package:base’:

        intersect, setdiff, setequal, union

--

The warning *masked from 'package:X'* is about a **namespace conflict**

???

Here, both `dplyr` and the `stats` package (which gets loaded automatically when you start R) have functions named `filter` and `lag`

---

# Namespace conflicts

Whenever a namespace conflict arises, the most recently loaded package will gain preference

The `filter()` function now refers specifically to the `dplyr` variant

--

What if we want the `stats` variant?
1. Use `stats::filter()`
2. Assign `filter &lt;- stats::filter`

---

# Solving namespace conflicts

### 1. Use `package::function()`

Explicitly call a conflicted function from a package using the `package::function()` syntax

--

We can also use `::` to clarify the source of a function or dataset in our code


``` r
dplyr::starwars # print the starwars data frame from the dplyr package
scales::comma(c(1000, 1000000)) # use the comma function, which comes from the scales package
```

--

The `::` syntax also allows us to call functions without loading the package (as long as it is installed)
  
---

# Solving namespace conflicts

### 2. Assign `function &lt;- package::function`

A more persistent option is to assign a conflicted name to a particular package

``` r
filter &lt;- stats::filter # note the lack of parentheses
filter &lt;- dplyr::filter # change it back again
```

???

### General advice

I would generally advocate for the temporary `package::function()` solution.

Another good rule of thumb is that you want to load your most important packages last. (e.g., load the tidyverse after you've already loaded any other packages)
  
Other than that, simply pay attention to any warnings when loading a new package and `?` is your friend if you're ever unsure (e.g., `?filter` will tell you which variant is being used)
- In truth, problematic namespace conflicts are rare. But it's good to be aware of them


---

# User-side namespace conflicts

Namespace conflicts don't just arise from loading packages

Users like you and me can (and probably will!) create them through assignment


---
class: inverse, center, middle
name: indexing

# Indexing


  
---

# Indexing

How do we index in R?

--

We've already seen an example of indexing in the form of R console output:


``` r
1+2
```

```
## [1] 3
```

The `[1]` above denotes the ﬁrst (and, in this case, only) element of our output

--

In this case, a vector of length one equal to the value "3"

---

# Indexing

Try the following in your console to see a more explicit example of indexed output:


``` r
rnorm(n = 50, mean = 0, sd = 1) # take 50 draws from the standard normal distribution
```

```
##  [1] -1.8178124738  0.6271936891 -0.3749069545  0.7378235540  0.7253086541
##  [6] -0.3921242681 -0.0133513440  0.3679928833 -0.6147329027 -1.0126890746
## [11]  0.2880122850 -0.5748250747 -1.3488714041 -0.8168316790  0.3454991584
## [16] -0.4671524910 -1.1312731856  0.5016111273  0.9733436542  0.8329742111
## [21]  0.0056161108  0.2034228199 -0.4345212969  0.4346082487  0.2399947150
## [26] -0.4014292545 -2.9283656715 -2.1259161786 -1.1412677442 -0.6240947201
## [31]  1.1065845900 -1.3097512751 -1.0747716587  0.6918365704 -1.1676930211
## [36]  1.4208836541 -0.0391350266  0.0001435349 -0.8207005206 -1.8561057914
## [41]  0.9309313809  0.3883003191  0.0514593111 -0.3299798555 -0.8187361010
## [46] -1.5978482023 -0.1355734537 -0.2821713484  0.7154166170  1.7801826220
```


---

# Option 1: [ ]

We can use `[]` to index objects that we create in R

``` r
a = 1:10
a[4] # get the 4th element of object "a"
```

```
## [1] 4
```

``` r
a[c(4, 6)] # get the 4th and 6th elements
```

```
## [1] 4 6
```

---

# Option 1: [ ]

This also works on larger arrays (vectors, matrices, data frames, and lists)

``` r
starwars &lt;- dplyr::starwars # assign for convenience
starwars[1, 1] # show the cell corresponding to the 1st row &amp; 1st column of the data frame.
```

```
## # A tibble: 1 × 1
##   name          
##   &lt;chr&gt;         
## 1 Luke Skywalker
```

--

What does `starwars[1:3, 1]` give you?

--


```
## # A tibble: 3 × 1
##   name          
##   &lt;chr&gt;         
## 1 Luke Skywalker
## 2 C-3PO         
## 3 R2-D2
```


---

# Option 1: [ ]

We haven't discussed them yet, but **lists** are a more complex type of array object in R

--

They can contain a collection of objects that don't share the same structure

--

For example, you can have lists containing:

- a scalar, a string, and a data frame
- a list of data frames
- a list of lists

---

# Option 1: [ ]

The relevance to indexing is that lists require two square brackets `[[]]` to index the parent list item and then the standard `[]` within that parent item. An example might help to illustrate:

``` r
my_list &lt;- list(
  a = "hello", 
  b = c(1,2,3), 
  c = data.frame(x = 1:5, y = 6:10))
my_list[[1]] # return the 1st list object
```

```
## [1] "hello"
```

``` r
my_list[[2]][3] # return the 3rd element of the 2nd list object
```

```
## [1] 3
```

---

# Option 2: $


Lists provide a nice segue to our other indexing operator: `$`
- Let's continue with the `my_list` example from the previous slide.


``` r
my_list
```

```
## $a
## [1] "hello"
## 
## $b
## [1] 1 2 3
## 
## $c
##   x  y
## 1 1  6
## 2 2  7
## 3 3  8
## 4 4  9
## 5 5 10
```

---
count: false

# Option 2: $


Lists provide a nice segue to our other indexing operator: `$`.
- Let's continue with the `my_list` example from the previous slide


``` r
my_list
```

```
*## $a
## [1] "hello"
## 
*## $b
## [1] 1 2 3
## 
*## $c
##   x  y
## 1 1  6
## 2 2  7
## 3 3  8
## 4 4  9
## 5 5 10
```

Notice how our (named) parent list objects are demarcated: `$a`,`$b` and `$c`

---

# Option 2: $

We can call these objects directly by name using the dollar sign, e.g.

``` r
my_list$a # return list object "a"
```

```
## [1] "hello"
```

``` r
my_list$b[3] # return the 3rd element of list object "b" 
```

```
## [1] 3
```

``` r
my_list$c$x # return column "x" of list object "c"
```

```
## [1] 1 2 3 4 5
```

???

**Aside:** Typing `View(my_list)` (or, equivalently, clicking on the object in RStudio's environment pane) provides a nice interactive window for exploring the nested structure of lists.

---

# Option 2: $

The `$` form of indexing also works for other object types

In some cases, you can also combine the two index options:

``` r
starwars$name[1]
```

```
## [1] "Luke Skywalker"
```

???

Note some key differences between the output from this example and that of our previous `starwars[1, 1]` example. What are they?
- Hint: Apart from the visual cues, try wrapping each command in `str()`.

---

# Option 2: $

Finally, `$` provides another way to avoid the "object not found" problem that we ran into earlier


``` r
x &lt; y # doesn't work
```

```
## Error: object 'x' not found
```

``` r
d$x &lt; d$y # works!
```

```
## [1] TRUE TRUE
```

---
class: inverse, center, middle
name: cleaning

# Cleaning up



---

# Removing objects

Use `rm()` to remove an object or objects from your working environment

``` r
a &lt;- "hello"
b &lt;- "world"
rm(a, b)
```

You can use `rm(list = ls())` to remove all objects in your working environment, though this is [frowned upon](https://www.tidyverse.org/articles/2017/12/workflow-vs-script/)
- Better just to start a new R session

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false,
  "slideNumberFormat": "%current%",
  "ratio": "16:9",
  "navigation": {
    "scroll": false
  }
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
