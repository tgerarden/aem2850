<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Welcome to the tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Todd Gerarden" />
    <script src="libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/tdg-slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">











class: center middle main-title section-title-4

# Welcome to the tidyverse

.class-info[

**Week 2**

AEM 2850 / 5850 : R for Business Analytics&lt;br&gt;
Cornell Dyson&lt;br&gt;
Spring 2025

Acknowledgements: 
&lt;!-- [Andrew Heiss](https://datavizm20.classes.andrewheiss.com),  --&gt;
&lt;!-- [Claus Wilke](https://wilkelab.org/SDS375/),  --&gt;
[Grant McDermott](https://github.com/uo-ec607/lectures),
[Allison Horst](https://github.com/allisonhorst/stats-illustrations)

]


---

# Announcements

If you are new to the class, please review canvas and [course site](https://aem2850.toddgerarden.com)

**Prelim dates:** Feb 27 and May 6 in class
&lt;!-- - SDS: we will use the Alternative Testing Program, submit form by Feb. 8 --&gt;

**Other reminders:**
- Bookmark [the schedule](https://aem2850.toddgerarden.com/schedule) and visit often
- Submit assignments via canvas by Monday at 11:59pm going forward

---

# Office hours update

**TA office hours:**
- Mondays 2:00pm - 6:00pm in Warren 370
- Fridays 2:00pm - 3:00pm in Warren 175


**My office hours:**
- Tuesdays 11:30 - 12:30 in Warren 464
- Thursday afternoons by appointment: [aem2850.youcanbook.me](https://aem2850.youcanbook.me)

---

# Questions before we get started?

---

# Plan for today

[Generative AI policy](#gai) and [Prologue](#prologue)

[Tidyverse basics](#basics)
  - [data frames](#tibbles) and [pipes](#pipes)

[Data transformation with dplyr](#dplyr)
  - [select](#select)
  - [filter](#filter)
  - [arrange](#arrange)
  - [mutate](#mutate)
  - [summarize](#summarize)
  - [other goodies](#goodies)


---
class: inverse, center, middle
name: gai

# Generative AI policy


---

# Generative AI policy

Generative AI (GAI) tools are very powerful assistants for widely used programming languages like R

You may use GAI tools in this course (e.g., ChatGPT, Claude, GitHub Copilot, etc.)

However, be aware of the limitations of GAI tools:
  - GAI tools can be misleading
  - GAI tools often proposed code that does not function
  - GAI code can be difficult to debug if you do not understand the fundamentals

---

# Generative AI example

Does anyone know where this quote is from?

&gt; A-B-C. A-always, B-be, C-closing. Always be closing! Always be closing!!
&gt; 
&gt; A-I-D-A. Attention, interest, decision, action. Attention -- do I have your attention? Interest -- are you interested? I know you are because it's fuck or walk. You close or you hit the bricks! Decision -- have you made your decision for Christ?!! And action.
&gt; 
&gt; A-I-D-A; get out there!! You got the prospects comin' in; you think they came in to get out of the rain? Guy doesn't walk on the lot unless he wants to buy. Sitting out there waiting to give you their money! Are you gonna take it?

---

# Generative AI example

&lt;img src="img/02/gggr-abc1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Generative AI example

&lt;img src="img/02/gggr-abc2.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Which answer is better?

.pull-left[
&lt;img src="img/02/gggr-abc1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="img/02/gggr-abc2.png" width="100%" style="display: block; margin: auto;" /&gt;
]

--

I **strongly** encourage you to focus on learning essential syntax and then using these tools as helpers (or not at all), rather than relying on them as replacements for your own knowledge and function

---
class: inverse, center, middle
name: prologue

# Prologue


---

# How we feel about the course, in a few words

&lt;!-- I haven't read all the surveys yet, but here are some common phrases that came up: --&gt;

&gt; really excited!

&lt;br&gt;

&gt; I feel great

&lt;br&gt;

--

&gt; nervous but excited

&lt;br&gt;

---

# Where we're from



How can we use your 85 survey responses to construct our origin story without having to read them one by one?

--

- **Caveat:** This is based on submissions as of 8:47 Tuesday

--

We can use R for this!

--

I won't go through details now

&lt;!-- I won't go through details now, but here is one way to approach it: --&gt;

&lt;!-- - use `readr` function `read_csv()` to import data from csv file --&gt;
&lt;!-- - use `dplyr` functions to manipulate data --&gt;
&lt;!-- - make maps using `ggplot2` --&gt;

By the end of the course you should be able to do this kind of thing easily


---

# Are we all from New York?

What share of us are from the state of New York?

--


``` r
# step 1: do a bunch of stuff that's omitted for clarity
# step 2: show us the answer!
ny_share
```

```
## # A tibble: 1 Ã— 2
##   origin   percent
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 new york      24
```

---

# Are we all from New York?


&lt;img src="02-slides_files/figure-html/us-map-1.png" width="1008" style="display: block; margin: auto;" /&gt;


---

# Are we all from the U.S.?


&lt;img src="02-slides_files/figure-html/world-map-1.png" width="1152" style="display: block; margin: auto;" /&gt;


---
class: inverse, center, middle
name: basics

# Tidyverse basics

---

# R "dialects"

Last week we *briefly* introduced several R programming concepts:
  - logical expressions
  - assignment
  - object types
  - [object names, namespace conflicts]
  - [indexing]

We did this using base R
  - **pro:** comes in the box, close parallels to other programming languages
  - **con:** can be confusing for new programmers (esp. indexing operations)

---

# R "dialects"

.more-left[
This course will primarily use the tidyverse

You can think of it as a particular "dialect" of R

This dialect is similar to human language

Intuitive if you're new to programming

Not representative of all R programming

Base R and `data.table` are alternative "dialects"
]

.less-right[
&lt;img src="img/02/r_first_then.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# Tidyverse vs. base R

Lots of debate over tidyverse vs. base R

--

Why we're using the tidyverse:
- Consistent philosophy and syntax
- Great documentation and community support
- For data wrangling and plotting, tidyverse is ðŸ”¥

--

&lt;br&gt;

Base R is still great, can do some things tidyverse can't

**data.table** is another great alternative for data wrangling

---

# Tidyverse vs. base R

Often a correspondence between tidyverse and base R commands:

| tidyverse  |  base |
|---|---|
| `?readr::read_csv`  | `?utils::read.csv` |
|  `?dplyr::if_else` |  `?base::ifelse` |
|  `?tibble::tibble` |  `?base::data.frame` |

Tidyverse alternatives typically offer extra features

--

**Remember:** There are always multiple ways to do something in R

---

# Let's load the tidyverse meta-package




``` r
library(tidyverse)
```

--


```
## â”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€
## âœ” dplyr     1.1.4     âœ” readr     2.1.5
## âœ” forcats   1.0.0     âœ” stringr   1.5.1
## âœ” ggplot2   3.5.1     âœ” tibble    3.2.1
## âœ” lubridate 1.9.4     âœ” tidyr     1.3.1
## âœ” purrr     1.0.2     
## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()
## â„¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
```

--

We just loaded a bunch of packages: **ggplot2**, **dplyr**, **tidyr**, **tibble**, etc.

We also see some **namespace conflicts**

---

# Tidyverse packages

When you install the tidyverse, you actually get a lot more packages:

``` r
tidyverse_packages()
```

```
##  [1] "broom"         "conflicted"    "cli"           "dbplyr"       
##  [5] "dplyr"         "dtplyr"        "forcats"       "ggplot2"      
##  [9] "googledrive"   "googlesheets4" "haven"         "hms"          
## [13] "httr"          "jsonlite"      "lubridate"     "magrittr"     
## [17] "modelr"        "pillar"        "purrr"         "ragg"         
## [21] "readr"         "readxl"        "reprex"        "rlang"        
## [25] "rstudioapi"    "rvest"         "stringr"       "tibble"       
## [29] "tidyr"         "xml2"          "tidyverse"
```

--

These other packages have to be loaded separately

---

# Tidyverse packages

Today we'll focus on [**dplyr**](https://dplyr.tidyverse.org/)

But first let's talk about data frames and pipes


---
name: tibbles

# Review: What are objects? 

There are many different *types* (or *classes*) of objects

Here are some objects that we'll be working with regularly:
- vectors
- matrices
- data frames
- lists
- functions


---

# Data frames

The most important object we'll work with is the **data frame**

You can think of it as an Excel spreadsheet

.pull-left[

``` r
# Create a small data frame called "d"
d &lt;- data.frame(x = c("a", "b", "c"), y = 7:9)
d
```

```
##   x y
## 1 a 7
## 2 b 8
## 3 c 9
```
]

.pull-right[

]

This is essentially just a table with columns named `x` and `y`

Each row is an observation telling us the values of both `x` and `y`

---

# Aside: tibbles are data frames with opinions

Tibbles are the default data frame in the tidyverse

Tibbles have some advantages, such as pretty printing

.pull-left[

``` r
# Print the small data frame called "d"
d
```

```
##   x y
## 1 a 7
## 2 b 8
## 3 c 9
```
]

.pull-right[

``` r
# Convert d to a tibble for pretty printing
as_tibble(d)
```

```
*## # A tibble: 3 Ã— 2
##   x         y
*##   &lt;chr&gt; &lt;int&gt;
## 1 a         7
## 2 b         8
## 3 c         9
```
]

**For this class, we'll treat "tibbles" and "data frames" as synonymous**

&lt;!-- We will primarily use tibbles in this course --&gt;

&lt;!-- Two functions may come in handy: --&gt;
&lt;!-- - `as_tibble()` converts data frames to tibbles --&gt;
&lt;!-- - `tibble()` creates new tibbles from scratch --&gt;

&lt;!-- See `vignette("tibble")` for more --&gt;

---

# Here is another example of a data frame


``` r
starwars # this data frame comes the tidyverse package dplyr
```

```
*## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
*##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
*## # â„¹ 77 more rows
*## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: pipes

# Pipes

**Generic programming question:** Does anyone know what pipes do?

--

Pipes allow us to pass information through a sequence of operations

--

The tidyverse loads the `magrittr` pipe, denoted `%&gt;%`

R now has a native pipe, denoted `|&gt;` (since R version 4.1.0)

--

They are identical for simple cases, but have some differences

--

We will use `|&gt;` in class

**Keyboard shortcut:** use `Ctrl/Cmd+Shift+m` to insert the pipe (with spaces)
&lt;!-- - You can [set the RStudio keyboard shortcut](https://r4ds.hadley.nz/workflow-pipes.html) to use either `%&gt;%` or `|&gt;` --&gt;

---

# Pipe usage

To see why using pipes is so powerful, consider this contrived example based on what we did this morning:

1. Wake up
2. Get out of bed
4. Get dressed
5. Drink coffee
6. Go to class


---

# A day without pipes

You could code this through a series of assignment operations:


``` r
me &lt;- wake_up(me)
me &lt;- get_out_of_bed(me)
me &lt;- get_dressed(me)
me &lt;- drink(me, "coffee")
me &lt;- go(me, "class")
```

Or by putting all these operations in a single line of code:


``` r
me &lt;- go(drink(get_dressed(get_out_of_bed(wake_up(me))), "coffee"), "class")
```

Neither is ideal

---

# Pipes are the best of both worlds

We can do everything at once, in order:


``` r
me |&gt; 
  wake_up() |&gt; 
  get_out_of_bed() |&gt; 
  get_dressed() |&gt; 
  drink("coffee") |&gt; 
  go("class")
```

Emphasis is on verbs (e.g., `wake_up`, `get_out_of_bed`, etc.), not nouns (i.e., `me`)

---

# Pipes: Best practices

Write linear code

Spread code out for readability: use one line per verb

Don't use pipes...
- when you need more than 10 (use intermediate objects instead)
- for multiple inputs or outputs
- for non-linear relationships

--

**Reminder:** `|&gt;` and `%&gt;%` can both be used, though they have some important differences for more advanced work. We will us `|&gt;` in this class.

---
class: inverse, center, middle
name: dplyr

# dplyr

---

# What is dplyr?

&lt;img src="img/02/dplyr_wrangling.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# What is dplyr?

The dplyr package provides a **grammar of data manipulation**

--

dplyr's functions are **verbs** that correspond to things we want to **do**

--

dplyr functions all have these things in common:
1. their first argument is a data frame
2. their other arguments describe what you want to do
3. their output is a new data frame

--

**1** + **3** + **pipes** allow us to combine simple steps to achieve complex results

---

# dplyr has five key verbs we will use

1. `select`: select columns (i.e., variables)

2. `filter`: subset rows based on their values

3. `arrange`: reorder rows based on their values

4. `mutate`: create new columns

5. `summarize`: collapse multiple rows into a single summary value


---

# dplyr verbs operate on different things

- Rows:
  - `filter`: subset rows based on their values
  - `arrange`: reorder rows based on their values
- Columns:
  - `select`: select columns (i.e., variables)
  - `mutate`: create new columns
- Groups of rows:
  - `summarize`: collapse multiple rows into a single summary value

--

Let's study these commands together using the `starwars` data frame that comes pre-packaged with dplyr

---
name: select

# 1) dplyr::select

Recall what the `starwars` data frame looks like:


``` r
starwars
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```


---

# 1) dplyr::select

`select` allows us to select columns / variables:


``` r
starwars |&gt; select(name)
```

```
*## # A tibble: 87 Ã— 1
##    name              
##    &lt;chr&gt;             
##  1 Luke Skywalker    
##  2 C-3PO             
##  3 R2-D2             
##  4 Darth Vader       
##  5 Leia Organa       
##  6 Owen Lars         
##  7 Beru Whitesun Lars
##  8 R5-D4             
##  9 Biggs Darklighter 
## 10 Obi-Wan Kenobi    
## # â„¹ 77 more rows
```

---

# 1) dplyr::select

You can get fancy: use commas to select multiple columns, deselect a column using "-", and select consecutive columns using "first:last"

``` r
starwars |&gt; 
  select(name:skin_color, species, -height)
```

```
## # A tibble: 87 Ã— 5
##    name                mass hair_color    skin_color  species
##    &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;  
##  1 Luke Skywalker        77 blond         fair        Human  
##  2 C-3PO                 75 &lt;NA&gt;          gold        Droid  
##  3 R2-D2                 32 &lt;NA&gt;          white, blue Droid  
##  4 Darth Vader          136 none          white       Human  
##  5 Leia Organa           49 brown         light       Human  
##  6 Owen Lars            120 brown, grey   light       Human  
##  7 Beru Whitesun Lars    75 brown         light       Human  
##  8 R5-D4                 32 &lt;NA&gt;          white, red  Droid  
##  9 Biggs Darklighter     84 black         light       Human  
## 10 Obi-Wan Kenobi        77 auburn, white fair        Human  
## # â„¹ 77 more rows
```

---

# 1) dplyr::select

You can also rename your selected variables at the same time:

``` r
starwars |&gt;
  select(alias = name, crib = homeworld)
```

```
## # A tibble: 87 Ã— 2
##    alias              crib    
##    &lt;chr&gt;              &lt;chr&gt;   
##  1 Luke Skywalker     Tatooine
##  2 C-3PO              Tatooine
##  3 R2-D2              Naboo   
##  4 Darth Vader        Tatooine
##  5 Leia Organa        Alderaan
##  6 Owen Lars          Tatooine
##  7 Beru Whitesun Lars Tatooine
##  8 R5-D4              Tatooine
##  9 Biggs Darklighter  Tatooine
## 10 Obi-Wan Kenobi     Stewjon 
## # â„¹ 77 more rows
```

---

# 1) dplyr::select

If you just want to rename columns without subsetting them, use `rename`:

``` r
starwars |&gt;
  rename(alias = name, crib = homeworld)
```

```
## # A tibble: 87 Ã— 14
##    alias    height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: crib &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;
```

---

# 1) dplyr::~~select~~ relocate

You can also use `relocate` to move important variables to the "front" of a data frame without subsetting:

``` r
starwars |&gt; 
  relocate(species, homeworld) |&gt;
  head(5)
```

```
## # A tibble: 5 Ã— 14
##   species homeworld name           height  mass hair_color skin_color  eye_color
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    
## 1 Human   Tatooine  Luke Skywalker    172    77 blond      fair        blue     
## 2 Droid   Tatooine  C-3PO             167    75 &lt;NA&gt;       gold        yellow   
## 3 Droid   Naboo     R2-D2              96    32 &lt;NA&gt;       white, blue red      
## 4 Human   Tatooine  Darth Vader       202   136 none       white       yellow   
## 5 Human   Alderaan  Leia Organa       150    49 brown      light       brown    
## # â„¹ 6 more variables: birth_year &lt;dbl&gt;, sex &lt;chr&gt;, gender &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
# 1) dplyr::~~select~~ relocate

&lt;img src="img/02/dplyr_relocate.png" width="65%" style="display: block; margin: auto;" /&gt;


---
class: inverse, center, middle
name: example

# Let's work through an example on Posit Cloud


---
name: filter

# 2) dplyr::filter

&lt;img src="img/02/dplyr_filter.jpg" width="75%" style="display: block; margin: auto;" /&gt;

---

# 2) dplyr::filter

`filter` allows us to focus on certain rows / observations

--

For example, you may only be interested in droids:


``` r
starwars |&gt; 
  filter(species == "Droid") 
```

```
## # A tibble: 6 Ã— 14
##   name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculiâ€¦
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculiâ€¦
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculiâ€¦
## 4 IG-88     200   140 none       metal       red               15 none  masculiâ€¦
## 5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
## 6 BB8        NA    NA none       none        black             NA none  masculiâ€¦
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 2) dplyr::filter

Or perhaps you want to subset the humans that are taller than I am:


``` r
starwars |&gt; 
  select(name, height, species) |&gt; 
  filter( 
    species == "Human", 
    height &gt;= 194
    )
```

Can you name one? *Hint: there's only one*

--


```
## # A tibble: 1 Ã— 3
##   name        height species
##   &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;  
*## 1 Darth Vader    202 Human
```

---

# 2) dplyr::filter

A useful `filter` use case is identifying/removing missing data using `is.na`:

``` r
starwars |&gt; 
  filter(is.na(height))
```

```
## # A tibble: 6 Ã— 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Arvel Crâ€¦     NA    NA brown      fair       brown             NA male  mascuâ€¦
## 2 Finn          NA    NA black      dark       dark              NA male  mascuâ€¦
## 3 Rey           NA    NA brown      light      hazel             NA femaâ€¦ feminâ€¦
## 4 Poe Dameâ€¦     NA    NA brown      light      brown             NA male  mascuâ€¦
## 5 BB8           NA    NA none       none       black             NA none  mascuâ€¦
## 6 Captain â€¦     NA    NA none       none       unknown           NA femaâ€¦ feminâ€¦
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 2) dplyr::filter

How could you build on this to remove rows with missing data?

--


``` r
starwars |&gt; 
  filter(!is.na(height)) # use ! for negation
```

```
## # A tibble: 81 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Skâ€¦    172    77 blond      fair       blue            19   male  mascuâ€¦
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascuâ€¦
##  3 R2-D2        96    32 &lt;NA&gt;       white, blâ€¦ red             33   none  mascuâ€¦
##  4 Darth Vâ€¦    202   136 none       white      yellow          41.9 male  mascuâ€¦
##  5 Leia Orâ€¦    150    49 brown      light      brown           19   femaâ€¦ feminâ€¦
##  6 Owen Laâ€¦    178   120 brown, grâ€¦ light      blue            52   male  mascuâ€¦
##  7 Beru Whâ€¦    165    75 brown      light      blue            47   femaâ€¦ feminâ€¦
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascuâ€¦
##  9 Biggs Dâ€¦    183    84 black      light      brown           24   male  mascuâ€¦
## 10 Obi-Wanâ€¦    182    77 auburn, wâ€¦ fair       blue-gray       57   male  mascuâ€¦
## # â„¹ 71 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: arrange

# 3) dplyr::arrange

`arrange` sorts the data frame based on the variable(s) you supply:


``` r
starwars |&gt; 
  arrange(birth_year)
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Wicket â€¦     88  20   brown      brown      brown            8   male  mascuâ€¦
##  2 IG-88       200 140   none       metal      red             15   none  mascuâ€¦
##  3 Luke Skâ€¦    172  77   blond      fair       blue            19   male  mascuâ€¦
##  4 Leia Orâ€¦    150  49   brown      light      brown           19   femaâ€¦ feminâ€¦
##  5 Wedge Aâ€¦    170  77   brown      fair       hazel           21   male  mascuâ€¦
##  6 Plo Koon    188  80   none       orange     black           22   male  mascuâ€¦
##  7 Biggs Dâ€¦    183  84   black      light      brown           24   male  mascuâ€¦
##  8 Han Solo    180  80   brown      fair       brown           29   male  mascuâ€¦
##  9 Lando Câ€¦    177  79   black      dark       brown           31   male  mascuâ€¦
## 10 Boba Feâ€¦    183  78.2 black      fair       brown           31.5 male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---

# 3) dplyr::arrange

We can also arrange items in descending order using `arrange(desc())`:

``` r
starwars |&gt; 
  arrange(desc(birth_year))
```

```
## # A tibble: 87 Ã— 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascuâ€¦
##  2 Jabba Dâ€¦    175  1358 &lt;NA&gt;       green-tanâ€¦ orange           600 hermâ€¦ mascuâ€¦
##  3 Chewbacâ€¦    228   112 brown      unknown    blue             200 male  mascuâ€¦
##  4 C-3PO       167    75 &lt;NA&gt;       gold       yellow           112 none  mascuâ€¦
##  5 Dooku       193    80 white      fair       brown            102 male  mascuâ€¦
##  6 Qui-Gonâ€¦    193    89 brown      fair       blue              92 male  mascuâ€¦
##  7 Ki-Adi-â€¦    198    82 white      pale       yellow            92 male  mascuâ€¦
##  8 Finis Vâ€¦    170    NA blond      fair       blue              91 male  mascuâ€¦
##  9 Palpatiâ€¦    170    75 grey       pale       yellow            82 male  mascuâ€¦
## 10 Cliegg â€¦    183    NA brown      fair       blue              82 male  mascuâ€¦
## # â„¹ 77 more rows
## # â„¹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;
```

---
name: mutate

# 4) dplyr::mutate

&lt;img src="img/02/dplyr_mutate.png" width="55%" style="display: block; margin: auto;" /&gt;

---

# 4) dplyr::mutate

You can create new columns from scratch or by transforming existing columns:

``` r
starwars |&gt; 
  select(name, height) |&gt;
  mutate(height_in_inches = height / 2.54)
```

```
## # A tibble: 87 Ã— 3
##    name               height height_in_inches
##    &lt;chr&gt;               &lt;int&gt;            &lt;dbl&gt;
##  1 Luke Skywalker        172             67.7
##  2 C-3PO                 167             65.7
##  3 R2-D2                  96             37.8
##  4 Darth Vader           202             79.5
##  5 Leia Organa           150             59.1
##  6 Owen Lars             178             70.1
##  7 Beru Whitesun Lars    165             65.0
##  8 R5-D4                  97             38.2
##  9 Biggs Darklighter     183             72.0
## 10 Obi-Wan Kenobi        182             71.7
## # â„¹ 77 more rows
```

---

# 4) dplyr::mutate

You can create new columns from scratch or by transforming existing columns:

``` r
starwars |&gt; 
  select(name, height) |&gt;
  mutate(height_in_inches = height / 2.54) |&gt;
  mutate(height_in_feet = height_in_inches / 12)
```

```
## # A tibble: 87 Ã— 4
##    name               height height_in_inches height_in_feet
##    &lt;chr&gt;               &lt;int&gt;            &lt;dbl&gt;          &lt;dbl&gt;
##  1 Luke Skywalker        172             67.7           5.64
##  2 C-3PO                 167             65.7           5.48
##  3 R2-D2                  96             37.8           3.15
##  4 Darth Vader           202             79.5           6.63
##  5 Leia Organa           150             59.1           4.92
##  6 Owen Lars             178             70.1           5.84
##  7 Beru Whitesun Lars    165             65.0           5.41
##  8 R5-D4                  97             38.2           3.18
##  9 Biggs Darklighter     183             72.0           6.00
## 10 Obi-Wan Kenobi        182             71.7           5.97
## # â„¹ 77 more rows
```

---


# 4) dplyr::mutate

`mutate` creates variables in order, so we can chain them together in a single call:

``` r
starwars |&gt; 
  select(name, height) |&gt;
  mutate(height_in_inches = height / 2.54, # separate with a comma
         height_in_feet = height_in_inches / 12)
```

```
## # A tibble: 87 Ã— 4
##    name               height height_in_inches height_in_feet
##    &lt;chr&gt;               &lt;int&gt;            &lt;dbl&gt;          &lt;dbl&gt;
##  1 Luke Skywalker        172             67.7           5.64
##  2 C-3PO                 167             65.7           5.48
##  3 R2-D2                  96             37.8           3.15
##  4 Darth Vader           202             79.5           6.63
##  5 Leia Organa           150             59.1           4.92
##  6 Owen Lars             178             70.1           5.84
##  7 Beru Whitesun Lars    165             65.0           5.41
##  8 R5-D4                  97             38.2           3.18
##  9 Biggs Darklighter     183             72.0           6.00
## 10 Obi-Wan Kenobi        182             71.7           5.97
## # â„¹ 77 more rows
```

---

# 4) dplyr::mutate

Boolean, logical, and conditional operators all work well with `mutate`

For example:

``` r
starwars |&gt; 
  filter(name=="Luke Skywalker" | name=="Anakin Skywalker") |&gt; 
  select(name, height) |&gt;
  mutate(tall = height &gt; 180)
```

How many rows do you think this will return? How many columns?

--


```
## # A tibble: 2 Ã— 3
##   name             height tall 
##   &lt;chr&gt;             &lt;int&gt; &lt;lgl&gt;
## 1 Luke Skywalker      172 FALSE
## 2 Anakin Skywalker    188 TRUE
```

---
name: summarize

# 5) dplyr::summarize

Often we want to get summary statistics or *collapse* our data

`summarize` provides an easy way to do this

--

**Example:** "What are the mininum, maximum, and average prices of `diamonds`?"

``` r
diamonds |&gt; 
  summarize(
    min = min(price),      # calculate the min price
    max = max(price),      # calculate the max price
    average = mean(price)  # calculate the mean price
  )
```

```
## # A tibble: 1 Ã— 3
##     min   max average
##   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
## 1   326 18823   3933.
```

---

# 5) dplyr::summarize

Including `na.rm = TRUE` keeps NAs from propagating to the end result:

.pull-left[

``` r
# probably not what we want
starwars |&gt; 
  summarize(mh = mean(height))
```

```
## # A tibble: 1 Ã— 1
##      mh
##   &lt;dbl&gt;
## 1    NA
```
]

.pull-right[

``` r
# better
starwars |&gt; 
  summarize(mh = mean(height, na.rm = TRUE))
```

```
## # A tibble: 1 Ã— 1
##      mh
##   &lt;dbl&gt;
## 1  175.
```
]

--

Is this a feature or a bug?

--

It depends on the context!

---

# Bonus: dplyr::group_by

`summarize` is particularly useful in combination with `group_by`:

``` r
starwars |&gt; 
  group_by(species) |&gt; # for each species
  summarize(mean_height = mean(height, na.rm = TRUE)) # calculate the mean height
```

```
## # A tibble: 38 Ã— 2
##    species   mean_height
##    &lt;chr&gt;           &lt;dbl&gt;
##  1 Aleena            79 
##  2 Besalisk         198 
##  3 Cerean           198 
##  4 Chagrian         196 
##  5 Clawdite         168 
##  6 Droid            131.
##  7 Dug              112 
##  8 Ewok              88 
##  9 Geonosian        183 
## 10 Gungan           209.
## # â„¹ 28 more rows
```

---

# Bonus: dplyr::ungroup

&lt;img src="img/02/group_by_ungroup.png" width="65%" style="display: block; margin: auto;" /&gt;

Groups are persistent (sort of), `ungroup` removes them

---
class: inverse, center, middle
name: goodies

# Let's work through an example on Posit Cloud

(the remaining slides contain other dplyr goodies for your reference)

---

# Other dplyr goodies: distinct

`distinct` to isolate unique observations:

``` r
starwars |&gt; distinct(species)
```

```
## # A tibble: 38 Ã— 1
##    species       
##    &lt;chr&gt;         
##  1 Human         
##  2 Droid         
##  3 Wookiee       
##  4 Rodian        
##  5 Hutt          
##  6 &lt;NA&gt;          
##  7 Yoda's species
##  8 Trandoshan    
##  9 Mon Calamari  
## 10 Ewok          
## # â„¹ 28 more rows
```


---

# Other dplyr goodies: count

`count` to get the number of observations:
.pull-left[

``` r
starwars |&gt; 
  count(species)
```

```
## # A tibble: 38 Ã— 2
##    species       n
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aleena        1
##  2 Besalisk      1
##  3 Cerean        1
##  4 Chagrian      1
##  5 Clawdite      1
##  6 Droid         6
##  7 Dug           1
##  8 Ewok          1
##  9 Geonosian     1
## 10 Gungan        3
## # â„¹ 28 more rows
```
]

.pull-right[

``` r
starwars |&gt; 
  group_by(species) |&gt; summarize(num = n())
```

```
## # A tibble: 38 Ã— 2
##    species     num
##    &lt;chr&gt;     &lt;int&gt;
##  1 Aleena        1
##  2 Besalisk      1
##  3 Cerean        1
##  4 Chagrian      1
##  5 Clawdite      1
##  6 Droid         6
##  7 Dug           1
##  8 Ewok          1
##  9 Geonosian     1
## 10 Gungan        3
## # â„¹ 28 more rows
```
]

---

# Other dplyr goodies: window functions

[Window functions](https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html) make it easy to get leads and lags, percentiles, cumulative sums, etc.
- These are often used in conjunction with grouped mutates
- See `vignette("window-functions")`

--

&lt;br&gt;

The final set of dplyr "goodies" worth mentioning are the family of join operations, but we'll come back to those later

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%",
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
